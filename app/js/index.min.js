!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t){var n,o,r;function a(e){var t=new FormData;t.append("action","add"),t.append("coords",e.coords),t.append("address",e.address),fetch("../api/api.php",{method:"POST",body:t}).then((function(e){return e.json()})).then((function(e){e.success||console.error("error")}))}function i(){return new Promise((function(e,t){fetch("../api/api.php?action=get").then((function(e){return e.json()})).then((function(n){n.success?e(n):t("err")}))}))}function s(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"heat_map";ymaps.ready(["Heatmap"]).then((function(){o=new ymaps.Map("map",{center:[43.031645225518204,44.649434751472754],zoom:13,controls:[]});var i=[],s={},c=ymaps.templateLayoutFactory.createClass('<div class="claster" ><span>$[properties.geoObjects.length]</span></div>');myClusterer=new ymaps.Clusterer({clusterIcons:[{href:"app/images/dist/map-claster.png",size:[58,80],offset:[-24,-80]}],clusterNumbers:[1],zoomMargin:[30],clusterIconContentLayout:c});for(var l=ymaps.templateLayoutFactory.createClass('<div class="ballon">\n        <div class="ballon_media" style="background-image: url($[properties.img])"></div>\n        <div class="ballon_content">\n          <p class="ballon_content_title"><strong>$[properties.name]</strong></p>\n          <ul class="ballon_content_info" >\n            <li><strong>Адрес:</strong> $[properties.address]</li>\n            <li><strong>Дата Акта проверки з/у:</strong> $[properties.dateVerification]</li>\n            <li><strong>Выявленое нарушения:</strong> $[properties.violations]</li>\n            <li><strong>Функциональное назначение:</strong> $[properties.function] </li>\n            <li><strong>Этажность (кол-во этажей):</strong> $[properties.floors]</li>\n            <li><strong>Площадь застройки (кв.м):</strong> $[properties.square]</li>\n            <li><strong><a href="$[properties.url]">Подробнее</a></strong></li>\n          </ul>\n        </div>\n      </div>'),d=0;d<e.length;d++)i.push(e[d].coords),s[d]=new ymaps.Placemark(e[d].coords,{id:e[d].id,address:e[d].address,coords:e[d].coords,iconContent:"<div class='marker-circ'></div>"},{balloonContentLayout:l,balloonOffset:[5,0],balloonCloseButton:!0,balloonMinWidth:450,balloonMaxWidth:450,balloonMinHeught:150,balloonMaxHeught:200,iconImageHref:"app/images/dist/map-a.png",iconImageSize:[50,70],iconImageOffset:[-25,-65],iconLayout:"default#imageWithContent",iconactive:"app/images/dist/map-a.png"}),"object_map"==t&&myClusterer.add(s[d]);var p=new ymaps.Heatmap(i,{radius:15,dissipating:!1,opacity:.9,intensityOfMidpoint:.5,gradient:{.1:"rgba(46, 204, 113,0.7)",.3:"rgba(243, 156, 18,0.8)",.7:"rgba(234, 72, 58, 0.9)",1:"rgba(162, 36, 25, 1)"}});function u(e){return new Promise((function(t,o){n.properties.set("iconCaption","поиск..."),ymaps.geocode(e).then((function(e){var o=e.geoObjects.get(0);n.properties.set({iconCaption:[o.getLocalities().length?o.getLocalities():o.getAdministrativeAreas(),o.getThoroughfare()||o.getPremise()].filter(Boolean).join(", "),balloonContent:o.getAddressLine()}),t(o.getAddressLine())})).catch((function(e){return o(e)}))}))}o.events.add("click",(function(e){var t=e.get("coords");n?(n.geometry.setCoordinates(t),u(t).then((function(e){a({address:e,coords:t})}))):(n=function(e){return new ymaps.Placemark(e,{iconCaption:"поиск..."},{preset:"islands#violetDotIconWithCaption",draggable:!0})}(t),o.geoObjects.add(n),n.events.add("dragend",(function(){u(n.geometry.getCoordinates())})),u(t).then((function(e){a({address:e,coords:t})})))})),"raion_map"==t&&r.forEach((function(e){var t=new ymaps.Polygon(e.coords,{hintContent:e.name},{fillColor:e.color,interactivityModel:"default#transparent",strokeWidth:2,opacity:.5});o.geoObjects.add(t),o.setBounds(t.geometry.getBounds())})),"heat_map"==t&&p.setMap(o),o.geoObjects.add(myClusterer)}))}i().then((function(e){r=e.result.raion,s(e.result.objects)}));var c=document.querySelectorAll(".actions_btn");c.forEach((function(e){e.addEventListener("click",(function(e){c.forEach((function(e){return e.classList.remove("active")})),e.target.classList.toggle("active"),o.destroy();var t=e.target.classList.contains("active")?e.target.dataset.map:"";i().then((function(e){s(e.result.objects,t)}))}))}))}]);