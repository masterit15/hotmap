!function(t){var e={};function o(n){if(e[n])return e[n].exports;var a=e[n]={i:n,l:!1,exports:{}};return t[n].call(a.exports,a,a.exports,o),a.l=!0,a.exports}o.m=t,o.c=e,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)o.d(n,a,function(e){return t[e]}.bind(null,a));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=0)}([function(t,e){var o,n,a,i;function r(t){$.ajax({url:"../api/api.php",method:"POST",data:t,success:function(t){t.success},error:function(t){console.error(t)}})}function s(){return new Promise((function(t,e){$.ajax({url:"../api/api.php",method:"POST",data:{action:"get"},success:function(e){e.success&&t(e)},error:function(t){e(t)}})}))}function c(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"heat_map";ymaps.ready(["Heatmap"]).then((function(){n=new ymaps.Map("map",{center:[43.031645225518204,44.649434751472754],zoom:13,controls:[]});var l=[],u={},d=ymaps.templateLayoutFactory.createClass('<div class="claster" ><span>$[properties.geoObjects.length]</span></div>');myClusterer=new ymaps.Clusterer({clusterIcons:[{href:"app/images/dist/map-classter.svg",size:[70,100],offset:[-24,-80]}],clusterNumbers:[1],zoomMargin:[30],clusterIconContentLayout:d});for(var p=ymaps.templateLayoutFactory.createClass('<div class="ballon">\n        <div class="ballon_media" style="background-image: url($[properties.img])"></div>\n        <div class="ballon_content">\n          <p class="ballon_content_title"><strong>$[properties.name]</strong></p>\n          <ul class="ballon_content_info" >\n            <li><strong>Адрес:</strong> $[properties.address]</li>\n            <li><strong>Дата Акта проверки з/у:</strong> $[properties.dateVerification]</li>\n            <li><strong>Выявленое нарушения:</strong> $[properties.violations]</li>\n            <li><strong>Функциональное назначение:</strong> $[properties.function] </li>\n            <li><strong>Этажность (кол-во этажей):</strong> $[properties.floors]</li>\n            <li><strong>Площадь застройки (кв.м):</strong> $[properties.square]</li>\n            <li><strong><a href="$[properties.url]">Подробнее</a></strong></li>\n          </ul>\n        </div>\n      </div>'),g=0;g<t.length;g++)l.push(t[g].coords),MyIconContentLayout=ymaps.templateLayoutFactory.createClass('<div class="ballon_icon">$[properties.iconContent]</div>'),u[g]=new ymaps.Placemark(t[g].coords,{id:t[g].id,address:t[g].address,coords:t[g].coords,iconContent:'<i style="color: '.concat(t[g].color,'" class="fas ').concat(t[g].icon,'"></i>'),hintContent:t[g].cat?t[g].cat:"Прочее"},{balloonContentLayout:p,balloonOffset:[5,0],balloonCloseButton:!0,balloonMinWidth:450,balloonMaxWidth:450,balloonMinHeught:150,balloonMaxHeught:200,iconImageHref:"app/images/dist/map-a.svg",iconImageSize:[70,90],iconImageOffset:[-25,-65],iconLayout:"default#imageWithContent",iconactive:"app/images/dist/map-a-hover.svg",iconContentLayout:MyIconContentLayout}),"object_map"==e&&myClusterer.add(u[g]);var f=new ymaps.Heatmap(l,{radius:15,dissipating:!1,opacity:.9,intensityOfMidpoint:.5,gradient:{.1:"rgba(46, 204, 113,0.7)",.3:"rgba(243, 156, 18,0.8)",.7:"rgba(234, 72, 58, 0.9)",1:"rgba(162, 36, 25, 1)"}});function m(t){o.properties.set("iconCaption","поиск..."),ymaps.geocode(t).then((function(e){var a=e.geoObjects.get(0);o.properties.set({iconCaption:[a.getLocalities().length?a.getLocalities():a.getAdministrativeAreas(),a.getThoroughfare()||a.getPremise()].filter(Boolean).join(", "),balloonContent:a.getAddressLine()});var l={action:"add",address:a.getAddressLine(),coords:t.toString()},u='<div class="form_add">\n                          <div class="group">\n                            <input type="text" name="address" value="'.concat(a.getAddressLine(),'">\n                            <label>Адрес</label>\n                          </div>\n                          <select name="cat" class="select" id="select_cat">\n                            <option value="#" data-icon="fa-envelope" data-color="#000">Категория</option>\n                            <option value="1" data-icon="fa-faucet" data-color="#3867d6">ЖКХ</option>\n                            <option value="2" data-icon="fa-dumpster" data-color="#079992">Мусор</option>\n                            <option value="3" data-icon="fa-road" data-color="#57606f">Дороги</option>\n                            <option value="4" data-icon="fa-hard-hat" data-color="#fa8231">Незаконное строительство</option>\n                          </select>\n                          <div class="form_action">\n                            <button type="submit" class="add">Добавить</button>\n                            <button class="cancel">Отмена</button>\n                          </div>\n                        </div>');$(".actions_content").addClass("active").html(u),$("#select_cat").select2({language:"ru",minimumResultsForSearch:-1}),$("#select_cat").on("select2:select",(function(t){l.cat=$(this).find('option[value="'.concat($(this).val(),'"]')).text(),l.color=$(this).find('option[value="'.concat($(this).val(),'"]')).data("color"),l.icon=$(this).find('option[value="'.concat($(this).val(),'"]')).data("icon"),l.catId=Number($(this).val())})),$(".actions_content button.add").on("click",(function(){r(l),$(".actions_content").removeClass("active").html("content"),o=null,n.destroy(),s().then((function(t){c(t.result.objects,i)}))})),$(".actions_content button.cancel").on("click",(function(){$(".actions_content").removeClass("active"),n.geoObjects.remove(o),o=null}))}))}n.events.add("click",(function(t){var e=t.get("coords");o?(o.geometry.setCoordinates(e),m(e)):(o=function(t){return new ymaps.Placemark(t,{iconCaption:"поиск..."},{preset:"islands#violetDotIconWithCaption",draggable:!0})}(e),n.geoObjects.add(o),o.events.add("dragend",(function(){m(o.geometry.getCoordinates())})),m(e))})),"raion_map"==e&&a.forEach((function(t){var e=new ymaps.Polygon(t.coords,{hintContent:t.name},{fillColor:t.color,interactivityModel:"default#transparent",strokeWidth:2,opacity:.5});n.geoObjects.add(e),n.setBounds(e.geometry.getBounds())})),"heat_map"==e&&f.setMap(n),n.geoObjects.add(myClusterer)}))}s().then((function(t){a=t.result.raion,c(t.result.objects),function(t){var e=[{mount:"Январь",count:0},{mount:"Февраль",count:0},{mount:"Март",count:0},{mount:"Апрель",count:0},{mount:"Май",count:0},{mount:"Июнь",count:0},{mount:"Июль",count:0},{mount:"Август",count:0},{mount:"Сентябрь",count:0},{mount:"Октябрь",count:0},{mount:"Ноябрь",count:0},{mount:"Декабрь",count:0}];t.forEach((function(t){var o;e[(o=t.createDate,1==Number(o.split("-")[1].split("")[1])?0:Number(o.split("-")[1].split("")[1])-1)].count+=1}));var o=[];e.forEach((function(t){o.push(t.count)}));var n=document.getElementById("chart").getContext("2d"),a=n.createLinearGradient(0,233,0,350);a.addColorStop(0,"rgba(36, 180, 171, 0.3)"),a.addColorStop(.2,"rgba(36, 180, 171, 0.2)"),a.addColorStop(1,"rgba(36, 180, 171, 0)");new Chart(n,{type:"line",data:{labels:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],datasets:[{label:"Количество",backgroundColor:a,pointBackgroundColor:"#24b4ab",borderWidth:3,borderColor:"#24b4ab",data:o}]},options:{responsive:!0,maintainAspectRatio:!0,animation:{easing:"easeInOutQuad",duration:2e3},scales:{xAxes:[{gridLines:{color:"rgba(0,0,0,0.1)",borderDash:[2,2],lineWidth:1}}],yAxes:[{gridLines:{color:"rgba(0,0,0,0.1)",borderDash:[2,2],lineWidth:1}}]},elements:{line:{tension:.5}},legend:{hidden:!0,display:!1},point:{backgroundColor:"white"},tooltips:{titleFontFamily:"Open Sans",backgroundColor:"rgba(0,0,0,0.3)",titleFontColor:"#fff",caretSize:15,cornerRadius:3,xPadding:15,yPadding:15},plugins:{legend:{display:!1}}}})}(t.result.objects)})),$("#select_filter").select2({language:"ru",minimumResultsForSearch:-1}),$("#select_filter").on("change",(function(){var t=this;n.destroy(),s().then((function(e){var o=e.result.objects;c(o=o.filter((function(e){return Number(e.catId)==Number($(t).val())})),i)}))})),$(".actions_btn").on("click",(function(){$(".actions_btn").removeClass("active"),$(this).addClass("active"),n.destroy(),i=$(this).hasClass("active")?$(this).data("map"):"",s().then((function(t){c(t.result.objects,i)}))})),$(".chart_btn").on("click",(function(){$(this).toggleClass("active"),$(this).hasClass("active")?$(".line-chart").fadeIn(200):$(".line-chart").fadeOut(200)}))}]);