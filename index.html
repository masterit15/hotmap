<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
</head>
<body>
  <div id="map"></div>
<script src="https://api-maps.yandex.ru/2.1/?apikey=256e028a-94b5-496f-b948-394772dc151a&lang=ru_RU" type="text/javascript"></script>
<script src="vld.js" type="text/javascript"></script>
<script src="https://yastatic.net/s3/mapsapi-jslibs/heatmap/0.0.1/heatmap.min.js" type="text/javascript"></script>
<link rel="stylesheet" href="style.css">
<script>

function addObject(coords){
  $.ajax({
    method: 'POST',
    url: '/add_object.php',
    data: {action: 'add', coords},
    success:function(res){
      console.log(res);
    },
    error:function(err){
      console.error(err)
    }
  })
}
function getObject(){
  $.ajax({
    method: 'POST',
    url: '/add_object.php',
    data: {action: 'get'},
    success:function(res){
      console.log(res);
    },
    error:function(err){
      console.error(err)
    }
  })
}
getObject()
ymaps.ready(['Heatmap']).then(function init() {
    var obj = json;
    var myMap = new ymaps.Map('map', {
        center: [43.031645225518204, 44.649434751472754],
        zoom: 11,
        controls: []
    });

    var data = [];
    for (var i = 0; i < obj.length; i++) {
        data.push([obj[i].Cells.geoData.coordinates[0], obj[i].Cells.geoData.coordinates[1]])
    }
    
    var heatmap = new ymaps.Heatmap(data, {
        // Радиус влияния.
        radius: 15,
        // Нужно ли уменьшать пиксельный размер точек при уменьшении зума. False - не нужно.
        dissipating: false,
        // Прозрачность тепловой карты.
        opacity: 0.8,
        // Прозрачность у медианной по весу точки.
        intensityOfMidpoint: 0.2,
        // JSON описание градиента.
        gradient: {
            0.1: 'rgba(128, 255, 0, 0.8)',
            0.3: 'rgba(255, 255, 0, 0.9)',
            0.7: 'rgba(234, 72, 58, 0.9)',
            1.0: 'rgba(162, 36, 25, 1)'
        }
    });
    console.log(heatmap);

    myMap.events.add('click', function(e) {
      let coords = e.get('coords');
      addObject(coords)
      // Если метка уже создана – просто передвигаем ее.
      // if (myPlacemark) {
      //     myPlacemark.geometry.setCoordinates(coords);
      //     getAddress(coords);
      // }
      // // Если нет – создаем.
      // else {
      //     myPlacemark = createPlacemark(coords);
      //     map.geoObjects.add(myPlacemark);
      //     // Слушаем событие окончания перетаскивания на метке.
      //     myPlacemark.events.add('dragend', function() {
      //       getAddress(myPlacemark.geometry.getCoordinates());
      //     });
      //     getAddress(coords);
      // }
    });



    heatmap.setMap(myMap);
});
</script>
</body>
</html>